/* eslint-disable react-native/no-inline-styles */
import React, {useState, useRef, forwardRef, useImperativeHandle} from 'react';
import {
  View,
  Text,
  Platform,
  StyleSheet,
  TextInputProps,
  TouchableOpacity,
} from 'react-native';
import {
  launchCamera,
  launchImageLibrary,
  ImageLibraryOptions,
} from 'react-native-image-picker';
import Svg, {G, Path} from 'react-native-svg';
import normalize from 'react-native-normalize';
import FastImage from 'react-native-fast-image';
import ImageView from 'react-native-image-viewing';

import {t} from '@i18n/index';
import color from '@styles/color';
import {showMessage} from '@utils/Toast';
import themeStyle from '@styles/theme.style';
import {IconLibrary} from '@components/Base';
import {checkCamera, checkUseLibrary} from '@utils/Permissions';

let options: ImageLibraryOptions = {
  quality: 1,
  selectionLimit: 1,
  mediaType: 'mixed',
  includeExtra: true,
  includeBase64: true,
};

export interface InputRef {
  clear: () => void;
  getValue: () => any;
  setValue: (value: any) => any;
}

const SvgComponent = () => (
  <Svg
    width={normalize(80)}
    height={normalize(80)}
    fill="none"
    style={{alignSelf: 'center', marginBottom: normalize(8)}}
    viewBox="0 0 400 400">
    <G fill="#ed1013">
      <Path d="M246.174 187.598c-1.478.042-1.842-1.35-1.108-2.134 2.104-2.246 7.73-5.024 30.696-18.548 10.224-6.022 10.96-6.404 11.982-4.842 1.234 1.886-.886 2.668-8.946 7.428-3.17 1.872-29.096 17.07-32.624 18.096ZM254.422 124.936c2.052-.076 2.006 1.758.738 2.626-1.484 1.018-24.124 13.428-29.588 16.414-3.238 1.77-3.74 1.85-4.268 1.066-.662-.98.652-1.936 2.052-2.75 30.768-17.886 29.874-17.314 31.064-17.36l.002.004ZM227.296 151.732c-1.478.082-1.676-1.264-.862-2.01 2.482-2.276 18.14-10.5 19.862-11.49 1.068-.614 2.462-.9 3.078.328.616 1.23.472 1.972-6.772 5.746-1.482.772-13.952 7.508-15.306 7.426ZM269.278 180.212c1.108.082 1.892 1.522.78 2.832-1.226 1.442-10.51 6.352-12.558 7.468-.822.448-1.802 1.066-2.504-.124-.654-1.11.288-1.764 1.026-2.34 2.052-1.6 11.286-7.714 13.254-7.838l.002.002ZM232.55 161.254c-1.846-.124-1.756-1.714-.902-2.504 1.45-1.34 9.142-5.358 12.024-6.566.9-.376 1.922-.9 2.544.206.65 1.152-.25 1.882-1.15 2.422-3.048 1.828-9.07 5.416-12.516 6.442Z" />
      <Path d="M212.77 139.708c3.346-1.608 30.73-16.336 46.424-25.08-.29-1.3-.62-2.74-1-4.34-18.956 10.36-45.938 24.826-49.364 27.04-2.792 1.8-2.908 1.144 7.346 19.45 1.716 3.062 10.47 18.832 19.86 34.346.042 0 2.94.02 4.26.02a4.298 4.298 0 0 1-.114-.184c-31.214-54.094-29.546-50.228-27.412-51.252ZM284.252 125.466a245.9 245.9 0 0 1-4.084.954 1364.12 1364.12 0 0 1 18.572 32.944c9.976 18.26 12.96 24.074 15.636 28.766.816 1.434-10.7 6.604-47.232 27.666l-.018 5.03c12.366-6.584 40.266-21.63 51.188-29.29 4.286-3.004-6.428-15.62-34.064-66.072l.002.002Z" />
    </G>
    <G fill="#ed1013">
      <Path d="M119.382 260.142a16.952 16.952 0 0 1 3.458-2.176c-13.134-26.334-12.204-23.864-10.488-24.57 4.222-1.736 45.596-21.124 56.508-26.674a2.5 2.5 0 0 1 3.364 1.108c1.854 3.778 5.278 10.284 10.384 20.47l1.648.05-.062-6.086a1944.378 1944.378 0 0 1-8.85-18.58c-.406-.864-.656-1.396-.862-1.642-.124-1.19-3.034-1.186-4.31-.576-17.778 8.52-57.364 26.888-61.638 29.342-2.87 1.648-2.994.984 6.196 19.822.628 1.29 2.308 4.762 4.65 9.51l.002.002Z" />
      <Path d="M154.744 221.002c2.052.056 1.888 1.848.574 2.668-1.518.946-24.876 11.966-30.49 14.65-3.328 1.59-3.854 1.64-4.308.82-.57-1.028.738-1.888 2.216-2.626 31.8-15.89 30.818-15.544 32.008-15.512ZM126.1 246.2c-1.478 0-1.606-1.36-.78-2.052 2.57-2.152 18.71-9.444 20.478-10.3 1.106-.536 2.544-.738 3.036.492s.332 1.928-7.1 5.334c-1.486.68-14.28 6.69-15.636 6.524l.002.002ZM130.818 256.008c-1.846-.246-1.638-1.842-.738-2.586 1.526-1.264 9.44-4.798 12.394-5.868.904-.328 1.978-.784 2.544.37.582 1.186-.37 1.846-1.272 2.38-3.242 1.642-9.438 4.842-12.926 5.704h-.002Z" />
    </G>
    <G fill="#ed1013">
      <Path d="M263.162 197.858c.41-1.148-2.216-2.4-3.652-2.42-19.696-.322-63.362-.676-68.286-.328-3.284.232-3.136-.41-3.036 20.56.008 1.626.012 6.374.082 12.804 1.352.04 2.774.08 4.27.118-.3-32.362-.916-29.56.984-29.46 4.556.246 50.27.818 62.5.454a2.46 2.46 0 0 1 2.544 2.462c0 4.272.282 11.82.482 23.594 1.42.03 2.804.066 4.132.106-.042-7.84-.044-16.496.024-26.04.008-.986 0-1.52-.042-1.848l-.002-.002Z" />
      <Path d="M237.104 206.394c1.8.954.902 2.498-.616 2.668-1.766.198-27.618 0-33.856 0-3.694 0-4.196-.204-4.268-1.108-.096-1.19 1.478-1.382 3.118-1.396 35.624-.288 34.552-.732 35.622-.164ZM200.376 216.694c-1.354-.616-.86-1.918.206-2.174 3.25-.786 20.928-.39 22.94-.41 1.232-.012 2.586.41 2.544 1.764-.042 1.354-.532 1.946-8.7 1.724-1.682-.046-15.84-.208-16.99-.904ZM200.376 227.528c-1.56-1.026-.692-2.358.452-2.626 1.938-.454 10.586-.192 13.706.082.984.086 2.134.124 2.134 1.436 0 1.312-1.148 1.522-2.174 1.56-3.61.134-10.63.328-14.118-.452Z" />
    </G>
    <Path
      fill="#ed1013"
      d="M170.454 254.23c1.284-1.382 3.34-2.412 5.71-3.516 2.462-1.148 4.616-.678 6.524 1.272.528.54.416.868-.042 1.314l-.842.826c1.592-.024 3.22-.05 4.884-.082a435.7 435.7 0 0 1 3.304-3.042c2.046-1.852 3.038-.946 5.458.41 1.192.668 1.792 1.274 2.06 2.36 1.14-.036 2.294-.074 3.464-.116-.008-4.436.078-10.152.466-17.51.13-2.462-.738-3.28-3.202-3.324-19.288-.344-25.238-.456-29.136-.328-4.214.138-2.444.444-3.228 21.756l4.574-.02h.006Zm6.08-15.416c5.13-.02 4.842 7.428 0 7.386-4.76-.042-4.966-7.366 0-7.386ZM164.468 136.18c-19.288-.346-25.236-.476-29.136-.328-4.842.184-1.784.538-3.776 32.748-.12 1.928.322 2.678 3.572 2.944s20.392.52 29.298.46c4.842-.03 1.722-3.688 3.242-32.5.13-2.46-.738-3.28-3.202-3.322l.002-.002Zm-21.708 5.992c5.13-.042 4.842 7.428 0 7.386-4.76-.042-4.966-7.346 0-7.386Zm-7.222 20.846c-1.272-4.882 2.184-6.75 6.854-8.906 2.468-1.14 4.638-.7 6.524 1.272.534.492.416.826-.042 1.272-14.048 13.74-13.336 14.2-13.336 6.36Zm28.028 4.226c-.028.74-.164 1.26-1.068 1.19-6.642-.528-13.296-.124-20.396-.41 2.626-3.16 13.212-12.846 14.118-13.666 2.046-1.852 3.028-.972 5.458.41 2.986 1.7 2.254 2.96 1.888 12.476Z"
    />
    <G fill="#191919">
      <Path d="M257.294 360.2c-.206-12.27.78-11.902-4.392-11.696l-36.728 1.314c-3.118.124-2.298.904-2.544 10.876-.082 3.366-.288 2.832 20.6 2.544 23.35-.328 23.104.246 23.062-3.036l.002-.002Zm-22.036 0c-19.574.452-19.41 1.19-19.246-.944.37-5.868-.82-6.812 1.436-6.854.042 0 31.68-.738 35.826-1.066 1.682-.124 1.068.082 1.518 7.592.124 1.928.042.78-19.534 1.272Z" />
      <Path d="M286.308 294.706c-.37-58.682-.986-63.772-12.27-64.428-7.182-.41-36.604-1.6-44.032.902-10.752 3.612-1.806 25.156-8.7 25.566-113.304 6.77-104.726-17.482-108.214 66.562a257.128 257.128 0 0 0-.154 11.2 31.26 31.26 0 0 1 4.264-1.584c-.228-23.378 1.168-48.416 1.964-53.236.82-4.884.534-13.5 14.034-16.086 14.24-2.708 28.11-.658 49.04-1.518 39.068-1.642 46.782 1.888 46.66-7.592-.164-15.758-1.066-18.918 4.186-19.698 9.726-1.518 25.238-.902 39.642-.328 9.604.37 7.058-.246 9.438 81.622.534 19.248 1.642 56.056-17.194 58.6-11.038 1.5-78.2 4.432-116.178 3.692a28.808 28.808 0 0 1-3.916 4.072c28.642.75 75.51-1.45 102.49-2.182 36.974-1.026 39.478-2.174 38.944-85.562l-.004-.002Z" />
    </G>
    <G fill="#191919">
      <Path d="M213.644 95.848c-.322 1.24-.674 2.574-1.052 4.004 18.716-.006 32.732-.06 42.92-.224a111.44 111.44 0 0 1-.934-3.714l-40.932-.064-.002-.002ZM272.108 56.446c-5.746-4.966-12.558-7.756-20.19-8.372-1.436-.124-3.2.986-4.104 0-1.272-1.436-1.148-19.822-20.806-24.54-7.346-1.764-14.034.124-20.026 4.596-1.068.78-1.56.74-2.052-.492-5.252-13.296-27.904-19.7-41.488-5.828-6.32 6.44-5.334 10.876-7.55 9.07-14.938-11.982-51.09.164-44.812 33.774-21.258-3.9-34.964 16.004-29.178 31.804 1.478 4.02-.124 3.28 84.864 3.364h.778c.306-1.192.652-2.504 1.028-3.96l-67.424.224c-14.198.084-15.8 1.272-16.332-1.52-2.626-14.116 6.936-25.196 20.682-25.81 7.428-.328 9.438.616 9.234-2.3-.616-8.082-1.026-13.294 1.108-18.342 6.074-14.568 22.816-18.63 32.994-15.47 8.29 2.584 8.782 6.074 10.792 2.216 3.406-6.648 8.084-16.044 21.012-16.25 15.102-.246 20.396 10.38 23.022 14.28 1.56 2.258 1.97 1.192 7.674-2.706 10.876-7.428 29.424-2.26 31.804 20.68.492 4.72 3.98-3.404 21.092 6.158 7.332 4.12 9.552 15.408 10.674 25.104 1.442-.34 2.976-.706 4.606-1.096-.714-9.684-2.898-20.68-7.402-24.582v-.002Z" />
    </G>
    <Path
      fill="#ed1013"
      d="M271.27 124.366c-4.902 1.154-5.684.692-6.138-1.524-6.486-31.63-9.4-31.2-4.802-32.624 3.732-1.16 9.466-2.596 28.234-7.182 2.378-.582 3.446 0 3.94 2.38 5.856 28.236 9.888 30.938 5.212 32.214-8.538 2.33-22.992 5.92-26.446 6.736Zm3.876-4.806c6.936-1.56 13.252-3.63 19.82-4.842.902-.166.906-.7.738-1.396-2.218-9.242-1.684-10.708-5.048-11.572-2.708-.696-3.864-1.276-5.376 1.026-.618.94-8.37 13.008-10.134 16.784Zm-7.592-3.16c2.01 7.592 1.268 7.326 11.244-9.562.336-.57.374-.868-.288-1.272-2.324-1.42-4.546-1.302-6.648.452-3.962 3.304-6.812 5.992-4.308 10.38Zm3.53-14.896c4.678-1.19 3.036-8.496-1.928-7.14-4.802 1.312-2.75 8.33 1.928 7.14Z"
    />
    <G fill="#ed1013">
      <Path d="M206.942 80.452c-23.172-5.804-23.802-5.95-27.29-6.402-1.354.164-1.49-.292-5.746 17.4-3.828 15.92-5.662 16.456-.78 17.688 30.862 7.788 30.614 8.454 31.558 4.76l7.346-29.26c.738-3.08-1.844-3.374-5.088-4.186Zm.984 5.746c0 .04-5.992 24.62-5.992 24.664-.534 2.34-.268 1.4-23.392-4.226-1.024-.25-2.01-.654-3.118-.7-.984-.04-1.156-.616-.902-1.56 6.848-25.376 5.582-26.22 7.264-25.974 26.428 6.772 26.632 5.62 26.14 7.796Z" />
      <Path d="M186.382 101.544c-4.062 0-3.564-.942-.616-11.368.986-3.488 3.106-2.2 13.254 5.868 4.344 3.454-6.566 3.694-12.64 5.498h.002Z" />
    </G>
    <Path
      fill="#ed1013"
      d="M148.916 352.854c-10.628-31.68-57.944-15.266-47.52 16.086 10.34 31.188 58.148 15.636 47.52-16.086Zm-14.774 11.04c-3.366.082-6.074-.412-6.032 1.518.082 3.364.698 6.032-1.232 6.074-2.462.082-4.842.574-4.924-1.232-.082-3.366.41-6.032-1.518-5.992-3.366.082-6.032.698-6.074-1.232-.082-2.502-.616-4.882 1.23-4.924 3.366-.082 6.032.41 5.992-1.518-.082-3.366-.738-6.074 1.23-6.114 2.462-.082 4.842-.576 4.924 1.23.082 3.366-.41 6.074 1.518 6.032 3.364-.082 6.074-.738 6.114 1.232.082 2.462.574 4.842-1.232 4.924l.004.002ZM258.608 29.4c3.366-.08 6.036.412 5.992-1.516-.076-3.366-.738-6.062 1.232-6.114 2.462-.066 4.862-.576 4.924 1.232.118 3.364-.41 6.076 1.518 6.032 3.366-.076 6.062-.74 6.114 1.19.068 2.46.576 4.86-1.232 4.924-3.364.118-6.076-.41-6.032 1.518.076 3.366.698 6.02-1.232 6.074-2.462.068-4.862.576-4.924-1.232-.118-3.364.41-6.036-1.518-5.992-3.366.076-6.022.698-6.074-1.19-.068-2.504-.574-4.882 1.232-4.924ZM110.382 142.746c-.042-1.97-2.75-1.312-6.114-1.23-1.928.042-1.436-2.668-1.518-6.032-.082-1.806-2.462-1.314-4.924-1.232-1.928.042-1.272 2.75-1.19 6.114.018.85-.49 1.23-1.352 1.396-1.094.21-2.758.076-4.64.122-1.806.042-1.314 2.42-1.23 4.924.042 1.928 2.708 1.312 6.074 1.23 1.928-.042 1.436 2.626 1.518 5.992.082 1.806 2.462 1.314 4.924 1.232 1.888-.042 1.272-2.708 1.19-6.074-.042-1.928 2.668-1.436 6.032-1.518 1.806-.082 1.312-2.462 1.23-4.924Z"
    />
  </Svg>
);

export interface InputProps extends TextInputProps {
  type: string;
  title: string;
  required?: boolean;
  valueInit?: string;
  placeholder?: string;
  disable?: boolean;
  multiline?: boolean;
  inputMediaOptionRef?: any;
}

export const InputMedia = forwardRef<InputRef, InputProps>(
  ({...props}, ref) => {
    const inputRef = useRef<any>(null);
    const [value, setValue] = useState<any>('');
    const [visible, setVisible] = useState(false);

    useImperativeHandle(ref, () => ({
      ...inputRef.current,
      getValue: () => value,
      clear() {
        setValue('');
      },
      setValue(vl: any) {
        setValue(vl);
      },
      value,
      undefined,
      async onLibrary() {
        options.mediaType = 'mixed';
        checkUseLibrary();
        try {
          const response: any = await launchImageLibrary(options);
          if (
            !response.error &&
            response.assets &&
            !response.didCancel &&
            response.assets.length > 0
          ) {
            if (response.assets[0]?.fileSize > 3145728) {
              console.log(t('image_too_large'));
              showMessage.warning(t('image_too_large'));
            } else {
              setValue(response.assets[0].base64);
            }
          }
        } catch (error) {
          console.error(error);
        }
      },
      onCamera() {
        options.mediaType = 'photo';
        checkCamera();
        launchCamera(options, response => {
          if (
            response.assets &&
            !response.didCancel &&
            response.assets.length > 0
          ) {
            setValue(response.assets[0].uri);
          }
        });
      },
    }));

    return (
      <View style={styles.inputContainer}>
        <View style={styles.titleContainer}>
          <Text style={styles.title}>
            {props.title}
            {props.required && <Text style={{color: 'red'}}>{' *'}</Text>} :
          </Text>
        </View>
        <TouchableOpacity
          style={styles.inputButton}
          activeOpacity={0.7}
          onPress={() =>
            value ? setVisible(true) : props.inputMediaOptionRef.current.show()
          }>
          {value ? (
            <>
              <FastImage
                source={{
                  uri: `data:application/pdf;base64,${value}`,
                  priority: FastImage.priority.normal,
                }}
                resizeMode="cover"
                style={{width: '100%', height: '100%', opacity: 0.9}}
              />
              <TouchableOpacity
                style={styles.iconClose}
                onPress={() => setValue('')}>
                <IconLibrary
                  size={25}
                  color="white"
                  name={'closecircleo'}
                  library="AntDesign"
                />
              </TouchableOpacity>
            </>
          ) : (
            <View>
              <SvgComponent />
              <Text style={styles.placeholder}>{t('add_photo_here')}</Text>
            </View>
          )}
        </TouchableOpacity>
        <ImageView
          images={[{uri: `data:application/pdf;base64,${value}`}]}
          visible={visible}
          imageIndex={0}
          onRequestClose={() => setVisible(false)}
        />
      </View>
    );
  },
);

const styles: any = StyleSheet.create({
  inputContainer: {
    overflow: 'hidden',
  },
  inputButton: {
    backgroundColor: color.WHITE,
    minHeight: normalize(150),
    borderRadius: normalize(15),
    overflow: 'hidden',
    marginHorizontal: normalize(16),
    borderWidth: Platform.OS === 'ios' ? normalize(1.32) : normalize(3.5),
    flexDirection: 'row',
    borderColor: color.DUSTY_GRAY,
    alignItems: 'center',
    justifyContent: 'center',
  },
  title: {
    fontSize: 18,
    marginLeft: normalize(30),
    marginVertical: normalize(8),
    marginBottom: normalize(2),
    fontFamily: themeStyle.FONT_FAMILY,
  },
  titleContainer: {
    paddingVertical: normalize(10),
  },
  placeholder: {
    fontSize: 16,
    color: 'gray',
    fontFamily: themeStyle.FONT_FAMILY,
  },
  iconClose: {
    position: 'absolute',
    zIndex: 99999,
    top: normalize(15),
    right: normalize(15),
  },
});
